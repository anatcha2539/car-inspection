<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ระบบตรวจรถ{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- ฟ้อนสวยงามทั้งระบบ -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        /* ฟ้อนทั้งระบบ */
        * {
            font-family: 'Kanit', sans-serif !important;
        }

        body { 
            background-color: #f4f7f6;
            font-size: 16px;
            line-height: 1.6;
        }

        h1, h2, h3, h4, h5, h6 {
            font-weight: 600;
            letter-spacing: 0.4px;
        }

        .page-header {
            background-color: #004a99; /* สีน้ำเงิน PTT */
            color: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .card-header { background-color: #f9f9f9; }

        .btn-primary {
            background-color: #004a99;
            border-color: #004a99;
            font-weight: 600;
        }

        .btn, .nav-link {
            font-weight: 500 !important;
        }

        label.form-label {
            font-weight: 500;
        }

        .list-group-item label {
            font-weight: 500;
        }
    </style>

    {% block extra_head %}{% endblock %}
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top shadow-sm mb-4">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="bi bi-car-front-fill"></i>
                ระบบตรวจเช็คสภาพรถ
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    
                    {% if user.is_authenticated %}
                        
                        {% if user.is_superuser or not user.groups.first.name == "Driver" %}
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'admin_dashboard' %}"><i class="bi bi-bar-chart-fill"></i> แดชบอร์ด</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{% url 'admin_main_index' %}"><i class="bi bi-gear-fill"></i> จัดการระบบ</a>
                            </li>
                        {% endif %}

                        {% if user.groups.first.name == "Driver" or user.is_superuser %}
                             <li class="nav-item">
                                <a class="nav-link" href="{% url 'driver_dashboard' %}"><i class="bi bi-clipboard-check"></i> หน้าตรวจรถ (To-Do)</a>
                            </li>
                        {% endif %}

                        {% if user.is_superuser %}
                        <li class="nav-item dropdown">
                            <a class="nav-link" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="bi bi-bell-fill"></i>
                                {% if new_problems_count > 0 %}
                                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                    {{ new_problems_count }}
                                </span>
                                {% endif %}
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                                {% if recent_problems_list %}
                                    {% for problem in recent_problems_list %}
                                    <li><a class="dropdown-item" href="/admin/inspection/problemreport/{{problem.id}}/change/">
                                        <small>{{ problem.vehicle.license_plate }}</small><br>
                                        <span class="text-danger">{{ problem.description|truncatechars:30 }}</span>
                                    </a></li>
                                    {% endfor %}
                                {% else %}
                                    <li><a class="dropdown-item text-muted" href="#">ไม่มีแจ้งเตือนใหม่</a></li>
                                {% endif %}
                            </ul>
                        </li>
                        {% endif %}
                        
                        <li class="nav-item">
                            <form action="/admin/logout/" method="POST" class="d-inline">
                                {% csrf_token %}
                                <button type="submit" class="nav-link btn btn-link" style="padding-top: 0.5rem; padding-bottom: 0.5rem;">
                                    <i class="bi bi-box-arrow-right"></i> ออกจากระบบ ({{ user.username }})
                                </button>
                            </form>
                        </li>
                    {% else %}
                        <li class="nav-item">
                            <a class="nav-link" href="/admin/login/">เข้าสู่ระบบ</a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        {% block content %}
        {% endblock %}
    </div>

    <footer class="text-center text-muted py-4 mt-5">
        <p>&copy; 2025 Vehicle Inspection System</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    
    {% block extra_scripts %}
    {% endblock %}
</body>
</html>
